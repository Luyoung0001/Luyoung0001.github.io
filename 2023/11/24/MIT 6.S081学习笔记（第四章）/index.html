

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="https://raw.githubusercontent.com/Luyoung0001/picBed/main/low.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Luyoung">
  <meta name="keywords" content="">
  
    <meta name="description" content="〇、前言本文主要完成MIT 6.S081 实验四：traps。开始之前，切换分支： 123$ git fetch$ git checkout traps$ make clean RISC-V assembly (easy)Question requirementsIt will be important to understand a bit of RISC-V assembly, which">
<meta property="og:type" content="article">
<meta property="og:title" content="MIT 6.S081学习笔记（第四章）">
<meta property="og:url" content="http://blog.luliang.online/2023/11/24/MIT%206.S081%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%89/index.html">
<meta property="og:site_name" content="Luyoung">
<meta property="og:description" content="〇、前言本文主要完成MIT 6.S081 实验四：traps。开始之前，切换分支： 123$ git fetch$ git checkout traps$ make clean RISC-V assembly (easy)Question requirementsIt will be important to understand a bit of RISC-V assembly, which">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/Luyoung0001/picBed/main/3aa59c94df994ea2abf94ed26a00eb40_1720253710031.png?token=ANB4BCOA4PPU2SPL7RZ22UTGRD6UW">
<meta property="article:published_time" content="2023-11-24T07:33:41.000Z">
<meta property="article:modified_time" content="2025-10-30T11:13:34.299Z">
<meta property="article:author" content="Luyoung">
<meta property="article:tag" content="学习">
<meta property="article:tag" content="笔记">
<meta property="article:tag" content="操作系统">
<meta property="article:tag" content="MIT 6.S081">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://raw.githubusercontent.com/Luyoung0001/picBed/main/3aa59c94df994ea2abf94ed26a00eb40_1720253710031.png?token=ANB4BCOA4PPU2SPL7RZ22UTGRD6UW">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>MIT 6.S081学习笔记（第四章） - Luyoung</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"blog.luliang.online","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":false,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 65vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Luyoung</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://raw.githubusercontent.com/Luyoung0001/picBed/main/1.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="MIT 6.S081学习笔记（第四章）"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-11-24 15:33" pubdate>
          2023年11月24日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          2.2k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          19 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">MIT 6.S081学习笔记（第四章）</h1>
            
            
              <div class="markdown-body">
                
                <span id="more"></span>

<p>〇、前言<br>本文主要完成<strong>MIT 6.S081</strong> 实验四：<strong>traps</strong>。<br>开始之前，切换分支：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git fetch<br>$ git checkout traps<br>$ make clean<br></code></pre></td></tr></table></figure>
<h2 id="RISC-V-assembly-easy"><a href="#RISC-V-assembly-easy" class="headerlink" title="RISC-V assembly (easy)"></a>RISC-V assembly (easy)</h2><h3 id="Question-requirements"><a href="#Question-requirements" class="headerlink" title="Question requirements"></a>Question requirements</h3><p>It will be important to understand a bit of <strong>RISC-V assembly</strong>, which you were exposed to in 6.004. There is a file <code>user/call.c</code> in your xv6 repo. <code>make fs.img</code> compiles it and also produces a readable assembly version of the program in <code>user/call.asm</code>.<br><code>c</code> 源代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/param.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;user/user.h&quot;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">g</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>  <span class="hljs-keyword">return</span> x+<span class="hljs-number">3</span>;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">f</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>  <span class="hljs-keyword">return</span> g(x);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d %d\n&quot;</span>, f(<span class="hljs-number">8</span>)+<span class="hljs-number">1</span>, <span class="hljs-number">13</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>部分<code>asm</code>代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs c">...<br><span class="hljs-type">int</span> <span class="hljs-title function_">g</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>   <span class="hljs-number">0</span>:	<span class="hljs-number">1141</span>                	addi	sp,sp,<span class="hljs-number">-16</span><br>   <span class="hljs-number">2</span>:	e422                	sd	s0,<span class="hljs-number">8</span>(sp)<br>   <span class="hljs-number">4</span>:	<span class="hljs-number">0800</span>                	addi	s0,sp,<span class="hljs-number">16</span><br>  <span class="hljs-keyword">return</span> x+<span class="hljs-number">3</span>;<br>&#125;<br>   <span class="hljs-number">6</span>:	<span class="hljs-number">250</span>d                	addiw	a0,a0,<span class="hljs-number">3</span><br>   <span class="hljs-number">8</span>:	<span class="hljs-number">6422</span>                	ld	s0,<span class="hljs-number">8</span>(sp)<br>   a:	<span class="hljs-number">0141</span>                	addi	sp,sp,<span class="hljs-number">16</span><br>   c:	<span class="hljs-number">8082</span>                	ret<br><br><span class="hljs-number">000000000000000</span>e &lt;f&gt;:<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">f</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>   e:	<span class="hljs-number">1141</span>                	addi	sp,sp,<span class="hljs-number">-16</span><br>  <span class="hljs-number">10</span>:	e422                	sd	s0,<span class="hljs-number">8</span>(sp)<br>  <span class="hljs-number">12</span>:	<span class="hljs-number">0800</span>                	addi	s0,sp,<span class="hljs-number">16</span><br>  <span class="hljs-keyword">return</span> g(x);<br>&#125;<br>  <span class="hljs-number">14</span>:	<span class="hljs-number">250</span>d                	addiw	a0,a0,<span class="hljs-number">3</span><br>  <span class="hljs-number">16</span>:	<span class="hljs-number">6422</span>                	ld	s0,<span class="hljs-number">8</span>(sp)<br>  <span class="hljs-number">18</span>:	<span class="hljs-number">0141</span>                	addi	sp,sp,<span class="hljs-number">16</span><br>  <span class="hljs-number">1</span>a:	<span class="hljs-number">8082</span>                	ret<br><br><span class="hljs-number">000000000000001</span>c &lt;main&gt;:<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>  <span class="hljs-number">1</span>c:	<span class="hljs-number">1141</span>                	addi	sp,sp,<span class="hljs-number">-16</span><br>  <span class="hljs-number">1</span>e:	e406                	sd	ra,<span class="hljs-number">8</span>(sp)<br>  <span class="hljs-number">20</span>:	e022                	sd	s0,<span class="hljs-number">0</span>(sp)<br>  <span class="hljs-number">22</span>:	<span class="hljs-number">0800</span>                	addi	s0,sp,<span class="hljs-number">16</span><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d %d\n&quot;</span>, f(<span class="hljs-number">8</span>)+<span class="hljs-number">1</span>, <span class="hljs-number">13</span>);<br>  <span class="hljs-number">24</span>:	<span class="hljs-number">4635</span>                	li	a2,<span class="hljs-number">13</span><br>  <span class="hljs-number">26</span>:	<span class="hljs-number">45b</span>1                	li	a1,<span class="hljs-number">12</span><br>  <span class="hljs-number">28</span>:	<span class="hljs-number">00000517</span>          	auipc	a0,<span class="hljs-number">0x0</span><br>  <span class="hljs-number">2</span>c:	<span class="hljs-number">7</span>d850513          	addi	a0,a0,<span class="hljs-number">2008</span> # <span class="hljs-number">800</span> &lt;<span class="hljs-built_in">malloc</span>+<span class="hljs-number">0xe8</span>&gt;<br>  <span class="hljs-number">30</span>:	<span class="hljs-number">00000097</span>          	auipc	ra,<span class="hljs-number">0x0</span><br>  <span class="hljs-number">34</span>:	<span class="hljs-number">62</span>a080e7          	jalr	<span class="hljs-number">1578</span>(ra) # <span class="hljs-number">65</span>a &lt;<span class="hljs-built_in">printf</span>&gt;<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-number">38</span>:	<span class="hljs-number">4501</span>                	li	a0,<span class="hljs-number">0</span><br>  <span class="hljs-number">3</span>a:	<span class="hljs-number">00000097</span>          	auipc	ra,<span class="hljs-number">0x0</span><br>  <span class="hljs-number">3</span>e:	<span class="hljs-number">298080e7</span>          	jalr	<span class="hljs-number">664</span>(ra) # <span class="hljs-number">2</span>d2 &lt;<span class="hljs-built_in">exit</span>&gt;<br>  ...<br></code></pre></td></tr></table></figure>



<p>Read the code in <code>call.asm</code> for the functions <code>g</code>, <code>f</code>, and <code>main</code>. The instruction manual for <strong>RISC-V</strong> is on the reference page. Here are some questions that you should answer (store the answers in a file answers-traps.txt):</p>
<ul>
<li><p>Q: Which registers contain arguments to functions? For example, which register holds <code>13</code> in main’s call to <code>printf</code>?</p>
</li>
<li><p>A: <code>a0~a7</code>, 事实上，当函数的参数超过 <strong>8</strong> 个时，就会保存到栈空间；否则，就会依次保存到寄存器中。从这里也可以看出，当可以使用寄存器的时候，我们不会使用内存，我们只在不得不使用内存的场景才使用它。从 <code>main</code>的汇编代码可以看到，<code>13</code> 被存到<code>a2</code>中。</p>
</li>
<li><p>Q: Where is the call to function <code>f</code> in the assembly code for <code>main</code>? Where is the call to <code>g</code>? (Hint: the compiler may inline functions.)</p>
</li>
<li><p>A: <code>main</code>函数里面没有<code>f</code> 的汇编代码，这是因为它被优化了。函数 <code>f </code>就是使传入的参数加 <code>3</code>后返回。考虑到编译器会进行内联优化，这就意味着一些显而易见的，编译时可以计算的数据会在编译时得出结果，而不是进行函数调用。其它同理。</p>
</li>
<li><p>Q: At what address is the function printf located?</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span><br><span class="hljs-title function_">printf</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *fmt, ...)</span><br>&#123;<br> <span class="hljs-number">65</span>a:	<span class="hljs-number">711</span>d                	addi	sp,sp,<span class="hljs-number">-96</span><br> <span class="hljs-number">65</span>c:	ec06                	sd	ra,<span class="hljs-number">24</span>(sp)<br> <span class="hljs-number">65</span>e:	e822                	sd	s0,<span class="hljs-number">16</span>(sp)<br> <span class="hljs-number">660</span>:	<span class="hljs-number">1000</span>                	addi	s0,sp,<span class="hljs-number">32</span><br> ...<br> &#125;<br></code></pre></td></tr></table></figure></li>
<li><p>A:  <strong>0x65a</strong>.</p>
</li>
<li><p>Q: What value is in the register <code>ra</code> just after the jalr to printf in main?</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">30:	00000097          	auipc	ra,0x0<br>34:	62a080e7          	jalr	1578(ra) <span class="hljs-comment"># 65a &lt;printf&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p>A: 使用 <code>auipc ra,0x0</code> 将当前程序计数器 <code>pc</code> 的值存入 <code>ra</code> 中；<code>jalr	1578(ra) # 65a &lt;printf&gt;</code>  跳转到偏移地址 <code>printf </code>处，也就是 <strong>0x65a</strong> 的位置。</p>
</li>
<li><p>Q: Run the following code.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i = <span class="hljs-number">0x00646c72</span>;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;H%x Wo%s&quot;</span>, <span class="hljs-number">57616</span>, &amp;i);<br></code></pre></td></tr></table></figure>
</li>
<li><p>Q1: What is the output?</p>
</li>
<li><p>A1: <strong>57616</strong> 转换为 <strong>16</strong> 进制为 <strong>e110</strong>，所以格式化描述符 <code>%x</code> 打印出了它的 <strong>16</strong> 进制值。所以会打印出：<strong>He110 World</strong>。</p>
</li>
<li><p>Q2: If the RISC-V were instead big-endian what would you set i to in order to yield the same output?</p>
</li>
<li><p>A2：如果在小端（little-endian）处理器中，数据<strong>0x00646c72</strong> 的高字节存储在内存的高位，那么从内存低位，也就是低字节开始读取，对应的 ASCII 字符为 <strong>rld</strong>。<br>如果在 大端（big-endian）处理器中，数据 <strong>0x00646c72</strong> 的高字节存储在内存的低位，那么从内存低位，也就是高字节开始读取其 ASCII 码为 <strong>dlr</strong>。<br>所以如果大端序和小端序输出相同的内容 <code>i</code> ，那么在其为大端序的时候，<code>i</code> 的值应该为 <strong>0x726c64</strong>，这样才能保证从内存低位读取时的输出为 <strong>rld</strong> 。</p>
</li>
<li><p>Q3: Would you need to change <strong>57616</strong> to a different value?</p>
</li>
<li><p>无论 <strong>57616</strong> 在大端序还是小端序，它的二进制值都为 <strong>e110</strong> 。大端序和小端序只是改变了多字节数据在内存中的存放方式，并不改变其真正的值的大小，所以 <strong>57616</strong> 始终打印为二进制 <strong>e110</strong> 。如果在大端序，<code>i</code> 的值应该为 <strong>0x00646c72</strong> 才能保证与小端序输出的内容相同。不用该变 <strong>57616</strong> 的值。</p>
</li>
<li><p>Q: In the following code, what is going to be printed after <code>y=</code>? (note: the answer is not a specific value.) Why does this happen?: <code>printf(&quot;x=%d y=%d&quot;, 3);</code></p>
</li>
<li><p>A: 函数的参数是通过寄存器<code>a1</code>, <code>a2</code> 等来传递。如果 <code>prinf</code> 少传递一个参数，那么其仍会从一个确定的寄存器中读取其想要的参数值，但是我们并没有给出这个确定的参数并将其存储在寄存器中，所以函数将从此寄存器中获取到一个随机的不确定的值作为其参数。故而此例中，<code>y=</code><strong>后面的值我们不能够确定，它是一个垃圾值</strong>。</p>
</li>
</ul>
<h2 id="Backtrace-moderate"><a href="#Backtrace-moderate" class="headerlink" title="Backtrace (moderate)"></a>Backtrace (moderate)</h2><h3 id="Question-requirements-1"><a href="#Question-requirements-1" class="headerlink" title="Question requirements"></a>Question requirements</h3><blockquote>
<p>For debugging it is often useful to have a backtrace: a list of the function calls on the stack above the point at which the error occurred.</p>
</blockquote>
<h3 id="Some-hints"><a href="#Some-hints" class="headerlink" title="Some hints:"></a>Some hints:</h3><ul>
<li>Add the prototype for backtrace to <code>kernel/defs.h</code> so that you can invoke backtrace in <code>sys_sleep</code>.</li>
<li>The GCC compiler stores the frame pointer of the currently executing function in the register <code>s0</code>. Add the following function to <code>kernel/riscv.h</code>:</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> uint64<br><span class="hljs-title function_">r_fp</span><span class="hljs-params">()</span><br>&#123;<br>  uint64 x;<br>  <span class="hljs-keyword">asm</span> <span class="hljs-title function_">volatile</span><span class="hljs-params">(<span class="hljs-string">&quot;mv %0, s0&quot;</span> : <span class="hljs-string">&quot;=r&quot;</span> (x) )</span>;<br>  <span class="hljs-keyword">return</span> x;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>and call this function in <code>backtrace</code> to read the current frame pointer. This function <strong>uses in-line assembly to read <code>s0</code></strong>.</p>
<ul>
<li>These lecture notes have a picture of the layout of stack frames. Note that the return address lives at a fixed <strong>offset (-8)</strong> from the frame pointer of a stackframe, and that the saved frame pointer lives at fixed <strong>offset (-16)</strong> from the frame pointer.</li>
<li>Xv6 allocates one page for each stack in the xv6 kernel at PAGE-aligned address. You can compute the top and bottom address of the stack page by using <code>PGROUNDDOWN(fp)</code> and <code>PGROUNDUP(fp)</code> (see <code>kernel/riscv.h</code>. These number are helpful for backtrace to terminate its loop.</li>
</ul>
<p>Once your backtrace is working, call it from panic in <code>kernel/printf.c</code> so that you see the kernel’s backtrace when it panics.</p>
<p>做这个实验，需要对函数调用栈有点了解。<br><img src="https://raw.githubusercontent.com/Luyoung0001/picBed/main/3aa59c94df994ea2abf94ed26a00eb40_1720253710031.png?token=ANB4BCOA4PPU2SPL7RZ22UTGRD6UW" alt="在这里插入图片描述"><br><a target="_blank" rel="noopener" href="https://mit-public-courses-cn-translatio.gitbook.io/mit6-s081/lec05-calling-conventions-and-stack-frames-risc-v/5.5-stack">【原文】</a>每一次我们调用一个函数，函数都会为自己创建一个<strong>Stack Frame</strong>，并且只给自己用。函数通过移动<strong>Stack Pointer</strong>来完成<strong>Stack Frame</strong>的空间分配。</p>
<p>对于<strong>Stack</strong>来说，是从<strong>高地址开始向低地址使用</strong>。所以栈总是向下增长。当我们想要创建一个新的<strong>Stack Frame</strong>的时候，总是对当前的<strong>Stack Pointer</strong>做<strong>减法</strong>。一个函数的<strong>Stack Frame</strong>包含了保存的寄存器，本地变量，并且，如果函数的参数多于8个，额外的参数会出现在<strong>Stack</strong>中。所以<strong>Stack Frame</strong>大小并不总是一样，即使在这个图里面看起来是一样大的。不同的函数有不同数量的本地变量，不同的寄存器，所以<strong>Stack Frame</strong>的大小是不一样的。但是有关<strong>Stack Frame</strong>有两件事情是确定的：</p>
<ul>
<li><strong>Return address</strong>总是会出现在<strong>Stack Frame</strong>的第一位</li>
<li>指向前一个<strong>Stack Frame</strong>的指针也会出现在栈中的固定位置</li>
</ul>
<p>有关<strong>Stack Frame</strong>中有两个重要的寄存器，第一个是<strong>SP（Stack Pointer）</strong>，它指向<strong>Stack</strong>的底部并代表了当前<strong>Stack Frame</strong>的位置。第二个是<strong>FP（Frame Pointer）</strong>，它指向当前<strong>Stack Frame</strong>的顶部。因为<strong>Return address</strong>和指向前一个<strong>Stack Frame</strong>的指针都在当前<strong>Stack Frame</strong>的固定位置，所以可以通过当前的<strong>FP</strong>寄存器寻址到这两个数据。</p>
<p>我们保存前一个<strong>Stack Frame</strong>的指针的原因是为了让我们能跳转回去。所以当前函数返回时，我们可以将前一个<strong>Frame Pointer</strong>存储到<strong>FP</strong>寄存器中。所以我们使用<strong>Frame Pointer</strong>来操纵我们的<strong>Stack Frames</strong>，并确保我们总是指向正确的函数。</p>
<p>所以，思路就是拿到指向当前 <strong>Frame Pointer</strong>的指针，然后在一个适当的空间中遍历所有的<strong>Frame Pointer</strong>，并在整个过程中打印每一个栈帧中的返回地址 <strong>Return address</strong>。</p>
<p>因此在<code>printf.c</code>中加上：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">backtrace</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    uint64 fp = r_fp();<br>    uint64 top = PGROUNDUP(fp);<br>    uint64 bottom = PGROUNDDOWN(fp);<br>    <span class="hljs-keyword">for</span> (;fp &gt;= bottom &amp;&amp; fp &lt; top; fp = *((uint64 *) (fp - <span class="hljs-number">16</span>))) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%p\n&quot;</span>, *((uint64 *) (fp - <span class="hljs-number">8</span>)));    <span class="hljs-comment">// 输出当前栈中返回地址</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>在 <code>panic</code> 函数中加上对它的调用：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span><br><span class="hljs-title function_">panic</span><span class="hljs-params">(<span class="hljs-type">char</span> *s)</span><br>&#123;<br>  ...<br>  backtrace();<br>  panicked = <span class="hljs-number">1</span>; <span class="hljs-comment">// freeze uart output from other CPUs</span><br>  <span class="hljs-keyword">for</span>(;;)<br>    ;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在 <code>kernel/defs.h</code> 中添加该函数声明：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">...<br><span class="hljs-type">void</span>            <span class="hljs-title function_">backtrace</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br></code></pre></td></tr></table></figure>

<p>在 <code>kerne/riscv.h</code> 中添加 <code>r_sp</code>函数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> uint64<br><span class="hljs-title function_">r_sp</span><span class="hljs-params">()</span><br>&#123;<br>  uint64 x;<br>  <span class="hljs-keyword">asm</span> <span class="hljs-title function_">volatile</span><span class="hljs-params">(<span class="hljs-string">&quot;mv %0, sp&quot;</span> : <span class="hljs-string">&quot;=r&quot;</span> (x) )</span>;<br>  <span class="hljs-keyword">return</span> x;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在 <code>kernel/sysproc.c</code> 中的 <code>sys_sleep</code> 函数中添加该函数调用：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">sys_sleep</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>&#123;<br>    ...<br>    backtrace();<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这样就好了。</p>
<h2 id="Alarm-hard"><a href="#Alarm-hard" class="headerlink" title="Alarm (hard)"></a>Alarm (hard)</h2><h3 id="Question-requirements-2"><a href="#Question-requirements-2" class="headerlink" title="Question requirements"></a>Question requirements</h3><blockquote>
<p>In this exercise you’ll add a feature to xv6 that periodically alerts a process as it uses CPU time. This might be useful for compute-bound processes that want to limit how much CPU time they chew up, or for processes that want to compute but also want to take some periodic action. More generally, you’ll be implementing a primitive form of <strong>user-level interrupt&#x2F;fault handlers</strong>; you could use something similar to handle page faults in the application, for example. Your solution is correct if it passes <code>alarmtest</code> and <code>usertests</code>.</p>
</blockquote>
<blockquote>
<p>You should add a new <code>sigalarm(interval, handler)</code> system call. If an application calls <code>sigalarm(n, fn),</code> then after every <strong>n</strong> “ticks” of CPU time that the program consumes, the kernel should cause application function <code>fn</code> to be called. When <code>fn</code> returns, the application should resume where it left off. A tick is a fairly arbitrary unit of time in xv6, determined by how often a hardware timer generates interrupts. If an application calls <code>sigalarm(0, 0)</code>, the kernel should stop generating periodic alarm calls.<br>You’ll find a file <code>user/alarmtest.c</code> in your xv6 repository. Add it to the Makefile. It won’t compile correctly until you’ve added <code>sigalarm</code> and <code>sigreturn</code> system calls (see below).</p>
</blockquote>
<h3 id="实验的步骤如下："><a href="#实验的步骤如下：" class="headerlink" title="实验的步骤如下："></a>实验的步骤如下：</h3><p>这个实验本质上就是，当一个进程运行的时候，设置一个 <strong>n-ticks</strong>, 然后这个进程会产生时钟中断。当发生 <strong>n</strong> 次时钟中断时，就会进入到 <code>handler()</code> 函数处理流程。<strong>这个实验可以很好的控制一个进程的时钟中断次数（CPU 时间）。</strong></p>
<h3 id="1、在-struct-proc-in-kernel-proc-h-中添加字段"><a href="#1、在-struct-proc-in-kernel-proc-h-中添加字段" class="headerlink" title="1、在 struct proc in kernel/proc.h 中添加字段"></a>1、在 struct proc in <code>kernel/proc.h</code> 中添加字段</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> &#123;</span><br>  <span class="hljs-comment">// ......</span><br>  <span class="hljs-type">int</span> alarm_interval;          <span class="hljs-comment">// n-ticks</span><br>  <span class="hljs-type">void</span>(*alarm_handler)();      <span class="hljs-comment">// Alarm handler</span><br>  <span class="hljs-type">int</span> alarm_ticks;             <span class="hljs-comment">// How many ticks left before next alarm goes off</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trapframe</span> *<span class="hljs-title">alarm_trapframe</span>;</span>  <span class="hljs-comment">// handler 之前要保存现场</span><br>  <span class="hljs-type">int</span> alarm_goingoff;          <span class="hljs-comment">// 是否已经处理完并返回？</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<h3 id="2、在allocproc-in-kernel-proc-c中初始化"><a href="#2、在allocproc-in-kernel-proc-c中初始化" class="headerlink" title="2、在allocproc() in kernel/proc.c中初始化"></a>2、在allocproc() in <code>kernel/proc.c</code>中初始化</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-keyword">struct</span> proc*<br><span class="hljs-title function_">allocproc</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  <span class="hljs-comment">// ......</span><br><br>found:<br>  p-&gt;pid = allocpid();<br>  <span class="hljs-comment">// Allocate a trapframe page.</span><br>  <span class="hljs-keyword">if</span>((p-&gt;trapframe = (<span class="hljs-keyword">struct</span> trapframe *)kalloc()) == <span class="hljs-number">0</span>)&#123;<br>    release(&amp;p-&gt;lock);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-comment">// Allocate a trapframe page for alarm_trapframe.</span><br>  <span class="hljs-keyword">if</span>((p-&gt;alarm_trapframe = (<span class="hljs-keyword">struct</span> trapframe *)kalloc()) == <span class="hljs-number">0</span>)&#123;<br>    release(&amp;p-&gt;lock);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  p-&gt;alarm_interval = <span class="hljs-number">0</span>;<br>  p-&gt;alarm_handler = <span class="hljs-number">0</span>;<br>  p-&gt;alarm_ticks = <span class="hljs-number">0</span>;<br>  p-&gt;alarm_goingoff = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">return</span> p;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3、实现-usertrap-in-kernel-trap-c-的实验功能"><a href="#3、实现-usertrap-in-kernel-trap-c-的实验功能" class="headerlink" title="3、实现 usertrap() in kernel/trap.c 的实验功能"></a>3、实现 usertrap() in <code>kernel/trap.c</code> 的实验功能</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span><br><span class="hljs-title function_">usertrap</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  ...<br>  <span class="hljs-comment">// give up the CPU if this is a timer interrupt.</span><br>  <span class="hljs-keyword">if</span>(which_dev == <span class="hljs-number">2</span>)&#123;<br>    <span class="hljs-keyword">if</span>(p-&gt;alarm_interval)&#123;  <span class="hljs-comment">// 如果设置了&#x27;定时&#x27;</span><br>      <span class="hljs-keyword">if</span>(--p-&gt;alarm_ticks &lt;= <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// 如果剩余&#x27;时间&#x27;不足,进入 handler()</span><br>        <span class="hljs-keyword">if</span>(!p-&gt;alarm_goingoff)&#123;   <span class="hljs-comment">// 确保没有被 handler()处理过</span><br>          p-&gt;alarm_ticks = p-&gt;alarm_interval; <span class="hljs-comment">// 恢复 alarm_ticks</span><br>          *p-&gt;alarm_trapframe = *p-&gt;trapframe; <span class="hljs-comment">// 拷贝,准备进入 handler()</span><br>          p-&gt;trapframe-&gt;epc = (uint64)p-&gt;alarm_handler; <span class="hljs-comment">// 跳到handler()</span><br>          p-&gt;alarm_goingoff = <span class="hljs-number">1</span>;  <span class="hljs-comment">// 表示 handler()已经执行过了</span><br>        &#125;<br>      &#125;<br>    &#125;<br>    yield();<br>  &#125;<br>...<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这样，这个实验就算做完了。最后，再完善下一些必要和不必要的细节。</p>
<h3 id="4、补充其它函数"><a href="#4、补充其它函数" class="headerlink" title="4、补充其它函数"></a>4、补充其它函数</h3><p>这两个函数是必要的，因为这是获取参数以及设置 <code>struct proc</code>字段的过程，它是实验通过的前提：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// lab4-3</span><br>uint64 <span class="hljs-title function_">sys_sigalarm</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>  <span class="hljs-type">int</span> n;  <span class="hljs-comment">// get param n-ticks</span><br>  uint64 fn; <span class="hljs-comment">// get param handler()</span><br>  argint(<span class="hljs-number">0</span>, &amp;n);<br>  argaddr(<span class="hljs-number">1</span>, &amp;fn);<br><br>  <span class="hljs-comment">// set params</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br>  p-&gt;alarm_interval = n;<br>  p-&gt;alarm_handler = (<span class="hljs-type">void</span>(*)())fn;<br>  p-&gt;alarm_ticks = n; <span class="hljs-comment">// left equils n of course before start!</span><br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br>uint64 <span class="hljs-title function_">sys_sigreturn</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br>  *p-&gt;trapframe = *p-&gt;alarm_trapframe;<br>  p-&gt;alarm_goingoff = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">return</span> p-&gt;alarm_trapframe-&gt;a0; <span class="hljs-comment">// return the return value of handler(), or cannot pass the test3()</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>回收进程：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">void</span><br><span class="hljs-title function_">freeproc</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> proc *p)</span><br>&#123;<br>  ...<br>  <span class="hljs-comment">// lab4-3</span><br>  <span class="hljs-keyword">if</span>(p-&gt;alarm_trapframe)<br>    kfree((<span class="hljs-type">void</span>*)p-&gt;alarm_trapframe);<br>  <span class="hljs-comment">// lab4-3</span><br>  p-&gt;alarm_interval = <span class="hljs-number">0</span>;<br>  p-&gt;alarm_handler = <span class="hljs-number">0</span>;<br>  p-&gt;alarm_ticks = <span class="hljs-number">0</span>;<br>  p-&gt;alarm_goingoff = <span class="hljs-number">0</span>;<br><br>  p-&gt;state = UNUSED;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>这个实验的难度比之前见到的任何一个实验都难且有意思，<strong>相当于手动实现了一次进程切换</strong>，是内核陷入的低级版本。</p>
<p><em>全文完，感谢阅读。</em></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/OS/" class="category-chain-item">OS</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%AD%A6%E4%B9%A0/" class="print-no-link">#学习</a>
      
        <a href="/tags/%E7%AC%94%E8%AE%B0/" class="print-no-link">#笔记</a>
      
        <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" class="print-no-link">#操作系统</a>
      
        <a href="/tags/MIT-6-S081/" class="print-no-link">#MIT 6.S081</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>MIT 6.S081学习笔记（第四章）</div>
      <div>http://blog.luliang.online/2023/11/24/MIT 6.S081学习笔记（第四章）/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Luyoung</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年11月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/12/04/xv6%20book%20Chapter4%20%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/" title="xv6 book Chapter4 中文翻译">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">xv6 book Chapter4 中文翻译</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/11/22/MIT%206.S081%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%89/" title="MIT 6.S081学习笔记（第三章）">
                        <span class="hidden-mobile">MIT 6.S081学习笔记（第三章）</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>







  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
