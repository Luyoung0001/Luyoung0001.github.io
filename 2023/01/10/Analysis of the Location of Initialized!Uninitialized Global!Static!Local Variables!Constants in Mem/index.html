

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="https://raw.githubusercontent.com/Luyoung0001/picBed/main/low.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Luyoung">
  <meta name="keywords" content="">
  
    <meta name="description" content="Development tools macOS(Apple M1) VScode otool binutils  Let’s start with a simple program1234567891011121314151617#include &lt;unistd.h&gt;int global_init_a &#x3D; 1;char global_init_b &#x3D; &#x27;a&#x27;;i">
<meta property="og:type" content="article">
<meta property="og:title" content="Analysis of the Location of Initialized&#x2F;Uninitialized Global&#x2F;Static&#x2F;Local Variables&#x2F;Constants in Mem">
<meta property="og:url" content="http://blog.luliang.online/2023/01/10/Analysis%20of%20the%20Location%20of%20Initialized!Uninitialized%20Global!Static!Local%20Variables!Constants%20in%20Mem/index.html">
<meta property="og:site_name" content="Luyoung">
<meta property="og:description" content="Development tools macOS(Apple M1) VScode otool binutils  Let’s start with a simple program1234567891011121314151617#include &lt;unistd.h&gt;int global_init_a &#x3D; 1;char global_init_b &#x3D; &#x27;a&#x27;;i">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-01-09T16:47:29.000Z">
<meta property="article:modified_time" content="2026-01-24T09:00:40.421Z">
<meta property="article:author" content="Luyoung">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="vscode macos">
<meta property="article:tag" content="c++">
<meta name="twitter:card" content="summary_large_image">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Analysis of the Location of Initialized/Uninitialized Global/Static/Local Variables/Constants in Mem - Luyoung</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"blog.luliang.online","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":false,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 65vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Luyoung</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://raw.githubusercontent.com/Luyoung0001/picBed/main/1.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Analysis of the Location of Initialized/Uninitialized Global/Static/Local Variables/Constants in Mem"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-01-10 00:47" pubdate>
          2023年1月10日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          691 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          6 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Analysis of the Location of Initialized/Uninitialized Global/Static/Local Variables/Constants in Mem</h1>
            
            
              <div class="markdown-body">
                
                <span id="more"></span>

<h2 id="Development-tools"><a href="#Development-tools" class="headerlink" title="Development tools"></a>Development tools</h2><ul>
<li>macOS(Apple M1)</li>
<li>VScode</li>
<li>otool</li>
<li>binutils</li>
</ul>
<h2 id="Let’s-start-with-a-simple-program"><a href="#Let’s-start-with-a-simple-program" class="headerlink" title="Let’s start with a simple program"></a>Let’s start with a simple program</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-type">int</span> global_init_a = <span class="hljs-number">1</span>;<br><span class="hljs-type">char</span> global_init_b = <span class="hljs-string">&#x27;a&#x27;</span>;<br><br><span class="hljs-type">int</span> global_unin_a;<br><span class="hljs-type">char</span> global_unin_b;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* argv[])</span> &#123;<br>    <span class="hljs-type">static</span> <span class="hljs-type">int</span> local_stat_init_a = <span class="hljs-number">2</span>;<br>    <span class="hljs-type">static</span> <span class="hljs-type">char</span> local_stat_init_b = <span class="hljs-string">&#x27;b&#x27;</span>;<br><br>    <span class="hljs-type">static</span> <span class="hljs-type">int</span> local_stat_unin_a;<br>    <span class="hljs-type">static</span> <span class="hljs-type">char</span> local_stat_unin_b;<br><br>    sleep(<span class="hljs-number">-1</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>After compiling it, type:</p>
<blockquote>
<p>otool -l a.out</p>
</blockquote>
<p>Outputs is:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><code class="hljs c">Load command <span class="hljs-number">0</span><br>      cmd LC_SEGMENT_64<br>  cmdsize <span class="hljs-number">72</span><br>  segname __PAGEZERO<br>   vmaddr <span class="hljs-number">0x0000000000000000</span><br>   vmsize <span class="hljs-number">0x0000000100000000</span><br>  fileoff <span class="hljs-number">0</span><br> filesize <span class="hljs-number">0</span><br>  maxprot <span class="hljs-number">0x00000000</span><br> initprot <span class="hljs-number">0x00000000</span><br>   nsects <span class="hljs-number">0</span><br>    flags <span class="hljs-number">0x0</span><br>Load command <span class="hljs-number">1</span><br>      cmd LC_SEGMENT_64<br>  cmdsize <span class="hljs-number">392</span><br>  segname __TEXT<br>   vmaddr <span class="hljs-number">0x0000000100000000</span><br>   vmsize <span class="hljs-number">0x0000000000004000</span><br>  fileoff <span class="hljs-number">0</span><br> filesize <span class="hljs-number">16384</span><br>  maxprot <span class="hljs-number">0x00000005</span><br> initprot <span class="hljs-number">0x00000005</span><br>   nsects <span class="hljs-number">4</span><br>    flags <span class="hljs-number">0x0</span><br>Section<br>  sectname __text<br>   segname __TEXT<br>      addr <span class="hljs-number">0x0000000100003f4c</span><br>      size <span class="hljs-number">0x000000000000003c</span><br>    offset <span class="hljs-number">16204</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">2</span> (<span class="hljs-number">4</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x80000400</span><br> reserved1 <span class="hljs-number">0</span><br> reserved2 <span class="hljs-number">0</span><br>Section<br>  sectname __stubs<br>   segname __TEXT<br>      addr <span class="hljs-number">0x0000000100003f88</span><br>      size <span class="hljs-number">0x000000000000000c</span><br>    offset <span class="hljs-number">16264</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">2</span> (<span class="hljs-number">4</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x80000408</span><br> reserved1 <span class="hljs-number">0</span> (index into indirect symbol table)<br> reserved2 <span class="hljs-number">12</span> (size of stubs)<br>Section<br>  sectname __stub_helper<br>   segname __TEXT<br>      addr <span class="hljs-number">0x0000000100003f94</span><br>      size <span class="hljs-number">0x0000000000000024</span><br>    offset <span class="hljs-number">16276</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">2</span> (<span class="hljs-number">4</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x80000400</span><br> reserved1 <span class="hljs-number">0</span><br> reserved2 <span class="hljs-number">0</span><br>Section<br>  sectname __unwind_info<br>   segname __TEXT<br>      addr <span class="hljs-number">0x0000000100003fb8</span><br>      size <span class="hljs-number">0x0000000000000048</span><br>    offset <span class="hljs-number">16312</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">2</span> (<span class="hljs-number">4</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x00000000</span><br> reserved1 <span class="hljs-number">0</span><br> reserved2 <span class="hljs-number">0</span><br>Load command <span class="hljs-number">2</span><br>      cmd LC_SEGMENT_64<br>  cmdsize <span class="hljs-number">152</span><br>  segname __DATA_CONST<br>   vmaddr <span class="hljs-number">0x0000000100004000</span><br>   vmsize <span class="hljs-number">0x0000000000004000</span><br>  fileoff <span class="hljs-number">16384</span><br> filesize <span class="hljs-number">16384</span><br>  maxprot <span class="hljs-number">0x00000003</span><br> initprot <span class="hljs-number">0x00000003</span><br>   nsects <span class="hljs-number">1</span><br>    flags <span class="hljs-number">0x10</span><br>Section<br>  sectname __got<br>   segname __DATA_CONST<br>      addr <span class="hljs-number">0x0000000100004000</span><br>      size <span class="hljs-number">0x0000000000000008</span><br>    offset <span class="hljs-number">16384</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">3</span> (<span class="hljs-number">8</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x00000006</span><br> reserved1 <span class="hljs-number">1</span> (index into indirect symbol table)<br> reserved2 <span class="hljs-number">0</span><br>Load command <span class="hljs-number">3</span><br>      cmd LC_SEGMENT_64<br>  cmdsize <span class="hljs-number">392</span><br>  segname __DATA<br>   vmaddr <span class="hljs-number">0x0000000100008000</span><br>   vmsize <span class="hljs-number">0x0000000000004000</span><br>  fileoff <span class="hljs-number">32768</span><br> filesize <span class="hljs-number">16384</span><br>  maxprot <span class="hljs-number">0x00000003</span><br> initprot <span class="hljs-number">0x00000003</span><br>   nsects <span class="hljs-number">4</span><br>    flags <span class="hljs-number">0x0</span><br>Section<br>  sectname __la_symbol_ptr<br>   segname __DATA<br>      addr <span class="hljs-number">0x0000000100008000</span><br>      size <span class="hljs-number">0x0000000000000008</span><br>    offset <span class="hljs-number">32768</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">3</span> (<span class="hljs-number">8</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x00000007</span><br> reserved1 <span class="hljs-number">2</span> (index into indirect symbol table)<br> reserved2 <span class="hljs-number">0</span><br>Section<br>  sectname __data<br>   segname __DATA<br>      addr <span class="hljs-number">0x0000000100008008</span><br>      size <span class="hljs-number">0x0000000000000015</span><br>    offset <span class="hljs-number">32776</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">3</span> (<span class="hljs-number">8</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x00000000</span><br> reserved1 <span class="hljs-number">0</span><br> reserved2 <span class="hljs-number">0</span><br>Section<br>  sectname __bss<br>   segname __DATA<br>      addr <span class="hljs-number">0x0000000100008020</span><br>      size <span class="hljs-number">0x0000000000000005</span><br>    offset <span class="hljs-number">0</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">2</span> (<span class="hljs-number">4</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x00000001</span><br> reserved1 <span class="hljs-number">0</span><br> reserved2 <span class="hljs-number">0</span><br>Section<br>  sectname __common<br>   segname __DATA<br>      addr <span class="hljs-number">0x0000000100008028</span><br>      size <span class="hljs-number">0x0000000000000005</span><br>    offset <span class="hljs-number">0</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">2</span> (<span class="hljs-number">4</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x00000001</span><br> reserved1 <span class="hljs-number">0</span><br> reserved2 <span class="hljs-number">0</span><br>Load command <span class="hljs-number">4</span><br>      cmd LC_SEGMENT_64<br>  cmdsize <span class="hljs-number">72</span><br>  segname __LINKEDIT<br>   vmaddr <span class="hljs-number">0x000000010000c000</span><br>   vmsize <span class="hljs-number">0x0000000000004000</span><br>  fileoff <span class="hljs-number">49152</span><br> filesize <span class="hljs-number">1154</span><br>  maxprot <span class="hljs-number">0x00000001</span><br> initprot <span class="hljs-number">0x00000001</span><br>   nsects <span class="hljs-number">0</span><br>    flags <span class="hljs-number">0x0</span><br>Load command <span class="hljs-number">5</span><br>            cmd LC_DYLD_INFO_ONLY<br>        cmdsize <span class="hljs-number">48</span><br>     rebase_off <span class="hljs-number">49152</span><br>    rebase_size <span class="hljs-number">8</span><br>       bind_off <span class="hljs-number">49160</span><br>      bind_size <span class="hljs-number">24</span><br>  weak_bind_off <span class="hljs-number">0</span><br> weak_bind_size <span class="hljs-number">0</span><br>  lazy_bind_off <span class="hljs-number">49184</span><br> lazy_bind_size <span class="hljs-number">16</span><br>     export_off <span class="hljs-number">49200</span><br>    export_size <span class="hljs-number">112</span><br>Load command <span class="hljs-number">6</span><br>     cmd LC_SYMTAB<br> cmdsize <span class="hljs-number">24</span><br>  symoff <span class="hljs-number">49320</span><br>   nsyms <span class="hljs-number">13</span><br>  stroff <span class="hljs-number">49544</span><br> strsize <span class="hljs-number">224</span><br>Load command <span class="hljs-number">7</span><br>            cmd LC_DYSYMTAB<br>        cmdsize <span class="hljs-number">80</span><br>      ilocalsym <span class="hljs-number">0</span><br>      nlocalsym <span class="hljs-number">5</span><br>     iextdefsym <span class="hljs-number">5</span><br>     nextdefsym <span class="hljs-number">6</span><br>      iundefsym <span class="hljs-number">11</span><br>      nundefsym <span class="hljs-number">2</span><br>         tocoff <span class="hljs-number">0</span><br>           ntoc <span class="hljs-number">0</span><br>      modtaboff <span class="hljs-number">0</span><br>        nmodtab <span class="hljs-number">0</span><br>   extrefsymoff <span class="hljs-number">0</span><br>    nextrefsyms <span class="hljs-number">0</span><br> indirectsymoff <span class="hljs-number">49528</span><br>  nindirectsyms <span class="hljs-number">3</span><br>      extreloff <span class="hljs-number">0</span><br>        nextrel <span class="hljs-number">0</span><br>      locreloff <span class="hljs-number">0</span><br>        nlocrel <span class="hljs-number">0</span><br>Load command <span class="hljs-number">8</span><br>          cmd LC_LOAD_DYLINKER<br>      cmdsize <span class="hljs-number">32</span><br>         name /usr/lib/dyld (offset <span class="hljs-number">12</span>)<br>Load command <span class="hljs-number">9</span><br>     cmd LC_UUID<br> cmdsize <span class="hljs-number">24</span><br>    uuid <span class="hljs-number">100537</span>C2-A683<span class="hljs-number">-360</span>E-A421-D1ED64F448DE<br>Load command <span class="hljs-number">10</span><br>      cmd LC_BUILD_VERSION<br>  cmdsize <span class="hljs-number">32</span><br> platform <span class="hljs-number">1</span><br>    minos <span class="hljs-number">11.3</span><br>      sdk <span class="hljs-number">11.3</span><br>   ntools <span class="hljs-number">1</span><br>     tool <span class="hljs-number">3</span><br>  version <span class="hljs-number">650.9</span><br>Load command <span class="hljs-number">11</span><br>      cmd LC_SOURCE_VERSION<br>  cmdsize <span class="hljs-number">16</span><br>  version <span class="hljs-number">0.0</span><br>Load command <span class="hljs-number">12</span><br>       cmd LC_MAIN<br>   cmdsize <span class="hljs-number">24</span><br>  entryoff <span class="hljs-number">16204</span><br> stacksize <span class="hljs-number">0</span><br>Load command <span class="hljs-number">13</span><br>          cmd LC_LOAD_DYLIB<br>      cmdsize <span class="hljs-number">56</span><br>         name /usr/lib/libSystem.B.dylib (offset <span class="hljs-number">24</span>)<br>   time stamp <span class="hljs-number">2</span> Thu Jan  <span class="hljs-number">1</span> <span class="hljs-number">08</span>:<span class="hljs-number">00</span>:<span class="hljs-number">02</span> <span class="hljs-number">1970</span><br>      current version <span class="hljs-number">1292.100</span><span class="hljs-number">.5</span><br>compatibility version <span class="hljs-number">1.0</span><span class="hljs-number">.0</span><br>Load command <span class="hljs-number">14</span><br>      cmd LC_FUNCTION_STARTS<br>  cmdsize <span class="hljs-number">16</span><br>  dataoff <span class="hljs-number">49312</span><br> datasize <span class="hljs-number">8</span><br>Load command <span class="hljs-number">15</span><br>      cmd LC_DATA_IN_CODE<br>  cmdsize <span class="hljs-number">16</span><br>  dataoff <span class="hljs-number">49320</span><br> datasize <span class="hljs-number">0</span><br>Load command <span class="hljs-number">16</span><br>      cmd LC_CODE_SIGNATURE<br>  cmdsize <span class="hljs-number">16</span><br>  dataoff <span class="hljs-number">49776</span><br> datasize <span class="hljs-number">530</span><br></code></pre></td></tr></table></figure>
<p>Let’s take out the segment information we need to see:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs c">Section<br>  sectname __text<br>   segname __TEXT<br>      addr <span class="hljs-number">0x0000000100003f4c</span><br>      size <span class="hljs-number">0x000000000000003c</span><br>    offset <span class="hljs-number">16204</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">2</span> (<span class="hljs-number">4</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x80000400</span><br> reserved1 <span class="hljs-number">0</span><br> reserved2 <span class="hljs-number">0</span><br> Section<br>  sectname __data<br>   segname __DATA<br>      addr <span class="hljs-number">0x0000000100008008</span><br>      size <span class="hljs-number">0x0000000000000015</span><br>    offset <span class="hljs-number">32776</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">3</span> (<span class="hljs-number">8</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x00000000</span><br> reserved1 <span class="hljs-number">0</span><br> reserved2 <span class="hljs-number">0</span><br> Section<br>  sectname __bss<br>   segname __DATA<br>      addr <span class="hljs-number">0x0000000100008020</span><br>      size <span class="hljs-number">0x0000000000000005</span><br>    offset <span class="hljs-number">0</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">2</span> (<span class="hljs-number">4</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x00000001</span><br> reserved1 <span class="hljs-number">0</span><br> reserved2 <span class="hljs-number">0</span><br>Section<br>  sectname __common<br>   segname __DATA<br>      addr <span class="hljs-number">0x0000000100008028</span><br>      size <span class="hljs-number">0x0000000000000005</span><br>    offset <span class="hljs-number">0</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">2</span> (<span class="hljs-number">4</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x00000001</span><br> reserved1 <span class="hljs-number">0</span><br> reserved2 <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>


<p>Look at its Symbol Table, type:</p>
<blockquote>
<p>nm a.out</p>
</blockquote>
<p>The output is:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0000000100008008</span> d __dyld_private<br><span class="hljs-number">0000000100000000</span> T __mh_execute_header<br><span class="hljs-number">0000000100008010</span> D _global_init_a<br><span class="hljs-number">0000000100008014</span> D _global_init_b<br><span class="hljs-number">0000000100008028</span> S _global_unin_a<br><span class="hljs-number">000000010000802</span>c S _global_unin_b<br><span class="hljs-number">0000000100003f</span>4c T _main<br><span class="hljs-number">0000000100008018</span> d _main.local_stat_init_a<br><span class="hljs-number">000000010000801</span>c d _main.local_stat_init_b<br><span class="hljs-number">0000000100008020</span> b _main.local_stat_unin_a<br><span class="hljs-number">0000000100008024</span> b _main.local_stat_unin_b<br>                 U _sleep<br>                 U dyld_stub_binder<br></code></pre></td></tr></table></figure>

<p>Conclusion:</p>
<blockquote>
<ul>
<li>Comparing the addr in the information given above, it can be judged that the initialized global variables and local static variables are in the __data segment, while the uninitialized global variables are in the __common segment, and the uninitialized local static variables are in the _ _bss section.</li>
</ul>
</blockquote>
<p>We can modify this program to initialize uninitialized variables to 0:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-type">int</span> global_init_a = <span class="hljs-number">1</span>;<br><span class="hljs-type">char</span> global_init_b = <span class="hljs-string">&#x27;a&#x27;</span>;<br><br><span class="hljs-type">int</span> global_unin_a = <span class="hljs-number">0</span>;<br><span class="hljs-type">char</span> global_unin_b = <span class="hljs-number">0</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* argv[])</span> &#123;<br>    <span class="hljs-type">static</span> <span class="hljs-type">int</span> local_stat_init_a = <span class="hljs-number">2</span>;<br>    <span class="hljs-type">static</span> <span class="hljs-type">char</span> local_stat_init_b = <span class="hljs-string">&#x27;b&#x27;</span>;<br><br>    <span class="hljs-type">static</span> <span class="hljs-type">int</span> local_stat_unin_a = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">static</span> <span class="hljs-type">char</span> local_stat_unin_b = <span class="hljs-number">0</span>;<br><br>    sleep(<span class="hljs-number">-1</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>Check the symbol table after compiling: (for convenience, we use the <code>objdump -t</code> command to view)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><br>SYMBOL TABLE:<br><span class="hljs-number">0000000100008008</span> l     O __DATA,__data __dyld_private<br><span class="hljs-number">0000000100008018</span> l     O __DATA,__data _main.local_stat_init_a<br><span class="hljs-number">000000010000801</span>c l     O __DATA,__data _main.local_stat_init_b<br><span class="hljs-number">0000000100008028</span> l     O __DATA,__bss _main.local_stat_unin_a<br><span class="hljs-number">000000010000802</span>c l     O __DATA,__bss _main.local_stat_unin_b<br><span class="hljs-number">0000000100000000</span> g     F __TEXT,__text __mh_execute_header<br><span class="hljs-number">0000000100008010</span> g     O __DATA,__data _global_init_a<br><span class="hljs-number">0000000100008014</span> g     O __DATA,__data _global_init_b<br><span class="hljs-number">0000000100008020</span> g     O __DATA,__common _global_unin_a<br><span class="hljs-number">0000000100008024</span> g     O __DATA,__common _global_unin_b<br><span class="hljs-number">0000000100003f</span>4c g     F __TEXT,__text _main<br><span class="hljs-number">0000000000000000</span>         *UND* _sleep<br><span class="hljs-number">0000000000000000</span>         *UND* dyld_stub_binder<br></code></pre></td></tr></table></figure>

<p>Surprisingly, initializing both variables to 0 is equivalent to no initialization. **So we generally do not need to initialize global variables or local static variables to 0, because it is unnecessary. **</p>
<h2 id="What-is-the-difference-between-the-common-section-and-the-bss-section"><a href="#What-is-the-difference-between-the-common-section-and-the-bss-section" class="headerlink" title="What is the difference between the __common section and the __bss section?"></a>What is the difference between the __common section and the __bss section?</h2><p>Observing the address information above, it can be found that the __commond segment and the __bss segment are connected together.<br>__common section: The __common section stores weakly referenced symbols, that is, uninitialized global variables, and then puts them into the __bss section when linking, and then they can be easily merged together~<br>__bss segment: The abbreviation of Block Started by Symbol, a memory area that stores uninitialized global variables and global variables initialized to 0 in the program. The BSS segment is a static memory allocation.</p>
<h2 id="Doesn’t-the-bss-section-occupy-the-executable-file-space-why"><a href="#Doesn’t-the-bss-section-occupy-the-executable-file-space-why" class="headerlink" title="Doesn’t the bss section occupy the executable file space, why?"></a>Doesn’t the bss section occupy the executable file space, why?</h2><p>We can take a look directly to find out. Using the command <code>otool -d</code>, you can see:</p>
<blockquote>
<p>(__DATA,__data) section<br>0000000100008008        00000000 00000000 00000001 00000061<br>0000000100008018        00000002 62</p>
</blockquote>
<p>It can be seen from <strong>SYMBOL TABLE</strong> that there are a total of 5 values in the (__DATA,__data) section, which are: 0,1,61,2,62.</p>
<ul>
<li>0 is __dyld_private, skip this for now;</li>
<li>1 is global_init_a;</li>
<li>61 is global_init_b(‘a’);</li>
<li>2 is local_stat_init_a;</li>
<li>62 is local_stat_init_b &#x3D; ‘b’;<br>This means that the __data segment holds the values ​​of initialized global variables and local static variables.</li>
</ul>
<p>Let’s take a look at the information in the <code>__bss</code> section, use the command <code>objdump -s</code> command, see:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">Contents of section __common:<br>&lt;skipping contents of bss section at [<span class="hljs-number">100008020</span>, <span class="hljs-number">100008025</span>)&gt;<br>Contents of section __bss:<br>&lt;skipping contents of bss section at [<span class="hljs-number">100008028</span>, <span class="hljs-number">10000802</span>d)&gt;<br></code></pre></td></tr></table></figure>

<p>It turned out that there was nothing inside. This is actually not difficult to understand. Stored in the __bss segment are uninitialized global variables and local static variables. Since there is no initialization, there is no need to record the value of the variable in the executable file (there is no value to record). The only thing needed is to give These variables have a certain memory address (like variables in the __data section). In this way, there are actually two methods: first, write some initial values in the corresponding position like the __data section to occupy the place, and the executable file can be directly mapped when it is loaded, which is exactly the same as the __data section; second, do not give __bss The segment occupies a place in the executable file, and the corresponding area is directly opened in the memory according to the __bss segment information when loading, that is, the place is postponed from the executable file to the time of loading. The compiler is the choice of the second method, which postpones the placeholder from the executable file to the loading time. The advantage of this is to reduce the size of the executable file. takes up any executable space, while approach one increases the executable size by at least 40KB.<br>But strictly speaking, the bss segment still occupies some executable file space. For example, there is a description of the bss segment in the segment table, and a description of related variables in the bss segment in the symbol table, but here is not the same concept.</p>
<h2 id="How-is-the-size-of-the-bss-segment-and-the-data-segment-calculated"><a href="#How-is-the-size-of-the-bss-segment-and-the-data-segment-calculated" class="headerlink" title="How is the size of the bss segment and the data segment calculated?"></a>How is the size of the bss segment and the data segment calculated?</h2><p>Simple addition? Let’s see. Type <code>objdump -h</code> to see:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">Sections:<br>Idx Name            Size     VMA              Type<br>  <span class="hljs-number">0</span> __text          <span class="hljs-number">0000003</span>c <span class="hljs-number">0000000100003f</span>4c TEXT<br>  <span class="hljs-number">1</span> __stubs         <span class="hljs-number">0000000</span>c <span class="hljs-number">0000000100003f</span>88 TEXT<br>  <span class="hljs-number">2</span> __stub_helper   <span class="hljs-number">00000024</span> <span class="hljs-number">0000000100003f</span>94 TEXT<br>  <span class="hljs-number">3</span> __unwind_info   <span class="hljs-number">00000048</span> <span class="hljs-number">0000000100003f</span>b8 DATA<br>  <span class="hljs-number">4</span> __got           <span class="hljs-number">00000008</span> <span class="hljs-number">0000000100004000</span> DATA<br>  <span class="hljs-number">5</span> __la_symbol_ptr <span class="hljs-number">00000008</span> <span class="hljs-number">0000000100008000</span> DATA<br>  <span class="hljs-number">6</span> __data          <span class="hljs-number">00000015</span> <span class="hljs-number">0000000100008008</span> DATA<br>  <span class="hljs-number">7</span> __common        <span class="hljs-number">00000005</span> <span class="hljs-number">0000000100008020</span> BSS<br>  <span class="hljs-number">8</span> __bss           <span class="hljs-number">00000005</span> <span class="hljs-number">0000000100008028</span> BSS<br></code></pre></td></tr></table></figure>
<p>It can be seen that the size of the __data section is 15, but we know that there are only 5 variables in the data section. combine</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><br>SYMBOL TABLE:<br><span class="hljs-number">0000000100008008</span> l     O __DATA,__data __dyld_private<br><span class="hljs-number">0000000100008018</span> l     O __DATA,__data _main.local_stat_init_a<br><span class="hljs-number">000000010000801</span>c l     O __DATA,__data _main.local_stat_init_b<br><span class="hljs-number">0000000100008028</span> l     O __DATA,__bss _main.local_stat_unin_a<br><span class="hljs-number">000000010000802</span>c l     O __DATA,__bss _main.local_stat_unin_b<br><span class="hljs-number">0000000100000000</span> g     F __TEXT,__text __mh_execute_header<br><span class="hljs-number">0000000100008010</span> g     O __DATA,__data _global_init_a<br><span class="hljs-number">0000000100008014</span> g     O __DATA,__data _global_init_b<br><span class="hljs-number">0000000100008020</span> g     O __DATA,__common _global_unin_a<br><span class="hljs-number">0000000100008024</span> g     O __DATA,__common _global_unin_b<br><span class="hljs-number">0000000100003f</span>4c g     F __TEXT,__text _main<br><span class="hljs-number">0000000000000000</span>         *UND* _sleep<br><span class="hljs-number">0000000000000000</span>         *UND* dyld_stub_binder<br></code></pre></td></tr></table></figure>

<p> In this way, the total is exactly 15 bytes.However, if we count as 4+4+1+1, it is 10 bytes. why? It turns out that there is an interval of 3 bytes between global_init_b and local_stat_init_a, which is a common “alignment” process in memory. Therefore, the size of the data segment or the bss segment is not necessarily the sum of the sizes of its internal variables, and is generally greater than or equal to the sum of the sizes of its internal variables. This is caused by memory alignment.</p>
<h2 id="Where-are-local-variables-stored"><a href="#Where-are-local-variables-stored" class="headerlink" title="Where are local variables stored?"></a>Where are local variables stored?</h2><p>Let’s change the code to:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-comment">// int global_init_a = 1;</span><br><span class="hljs-comment">// char global_init_b = &#x27;a&#x27;;</span><br><br><span class="hljs-comment">// int global_unin_a = 0;</span><br><span class="hljs-comment">// char global_unin_b = 0;</span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* argv[])</span> &#123;<br>    <span class="hljs-comment">// static int local_stat_init_a = 2;</span><br>    <span class="hljs-comment">// static char local_stat_init_b = &#x27;b&#x27;;</span><br><br>    <span class="hljs-type">int</span> local_init_a = <span class="hljs-number">3</span>;<br>    <span class="hljs-type">char</span> local_init_b = <span class="hljs-string">&#x27;c&#x27;</span>;<br><br>    <span class="hljs-type">int</span> local_unin_a;<br>    <span class="hljs-type">char</span> local_unin_b;<br><br>    <span class="hljs-comment">// static int local_stat_unin_a = 0;</span><br>    <span class="hljs-comment">// static char local_stat_unin_b = 0;</span><br><br>    <span class="hljs-comment">// sleep(-1);</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>After compiling, type <code>otool -tv</code> to disassemble, you can see:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c">_main:<br><span class="hljs-number">0000000100003f</span>88        sub     sp, sp, #<span class="hljs-number">0x20</span><br><span class="hljs-number">0000000100003f</span>8c        mov     w8, #<span class="hljs-number">0x0</span><br><span class="hljs-number">0000000100003f</span>90        str     wzr, [sp, #<span class="hljs-number">0x1c</span>]<br><span class="hljs-number">0000000100003f</span>94        str     w0, [sp, #<span class="hljs-number">0x18</span>]<br><span class="hljs-number">0000000100003f</span>98        str     x1, [sp, #<span class="hljs-number">0x10</span>]<br><span class="hljs-number">0000000100003f</span>9c        mov     w9, #<span class="hljs-number">0x3</span><br><span class="hljs-number">0000000100003f</span>a0        str     w9, [sp, #<span class="hljs-number">0xc</span>]<br><span class="hljs-number">0000000100003f</span>a4        mov     w9, #<span class="hljs-number">0x63</span><br><span class="hljs-number">0000000100003f</span>a8        strb    w9, [sp, #<span class="hljs-number">0xb</span>]<br><span class="hljs-number">0000000100003f</span>ac        mov     x0, x8<br><span class="hljs-number">0000000100003f</span>b0        add     sp, sp, #<span class="hljs-number">0x20</span><br><span class="hljs-number">0000000100003f</span>b4        ret<br></code></pre></td></tr></table></figure>
<p><code>sp</code> is the pointer to the top of the stack, we mainly focus on these lines:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0000000100003f</span>9c        mov     w9, #<span class="hljs-number">0x3</span><br><span class="hljs-number">0000000100003f</span>a0        str     w9, [sp, #<span class="hljs-number">0xc</span>]<br><span class="hljs-number">0000000100003f</span>a4        mov     w9, #<span class="hljs-number">0x63</span><br><span class="hljs-number">0000000100003f</span>a8        strb    w9, [sp, #<span class="hljs-number">0xb</span>]<br></code></pre></td></tr></table></figure>
<p>This is actually just these two lines of code:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> local_init_a = <span class="hljs-number">3</span>;<br>   <span class="hljs-type">char</span> local_init_b = <span class="hljs-string">&#x27;c&#x27;</span>;<br></code></pre></td></tr></table></figure>


<p>It can be seen that sp is getting smaller and smaller. We know that the stack grows toward small memory addresses. According to the disassembly code, it is not difficult to see that local variables are stored in the stack.</p>
<h2 id="What-are-the-default-values-of-global-variables-static-variables-and-local-variables"><a href="#What-are-the-default-values-of-global-variables-static-variables-and-local-variables" class="headerlink" title="What are the default values of global variables, static variables and local variables?"></a>What are the default values of global variables, static variables and local variables?</h2><p>The answer to this question was known when I first started learning C language: the default value of global variables and static variables is 0, and the default value of local variables is uncertain. Here’s a closer look at why this is the case.</p>
<p>Both global variables and local static variables are stored in the __bss segment and the __common segment. The default value only needs to be analyzed in units of segments. Here we take the __bss segment as an example.<br>The information of __bss is as follows:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c">Section<br>  sectname __bss<br>   segname __DATA<br>      addr <span class="hljs-number">0x0000000100001028</span><br>      size <span class="hljs-number">0x0000000000000005</span><br>    offset <span class="hljs-number">0</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">2</span> (<span class="hljs-number">4</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>      type S_ZEROFILL<br></code></pre></td></tr></table></figure>

<p>Note that type S_ZEROFILL is to require all the contents of this section to be filled with 0. Why is the default value of global variables and static variables 0, while local variables are undefined?<br>It’s actually easy to understand. Global variables and static variables are stored in the __bss segment and __common segment. The memory address is known when loading, and the overhead of filling 0 is not too large, and global variables and static variables act on the entire program life cycle, and it is also valuable to initialize them of. In contrast to local variables, there are a large number of local variables with a short life cycle. They are stored on the stack and their memory addresses cannot be determined in advance. If the local variables are filled with 0 and initialized every time, it will not only consume resources, but also have small benefits, which is not worth the candle.</p>
<h2 id="Will-variables-modified-by-const-have-different-locations-in-memory"><a href="#Will-variables-modified-by-const-have-different-locations-in-memory" class="headerlink" title="Will variables modified by const have different locations in memory?"></a>Will variables modified by const have different locations in memory?</h2><p>In order to study this problem, we modify the code again:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">int</span> global_init_a = <span class="hljs-number">1</span>;<br><span class="hljs-type">char</span> global_init_b = <span class="hljs-string">&#x27;a&#x27;</span>;<br><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> global_con_init_a = <span class="hljs-number">2</span>;<br><span class="hljs-type">const</span> <span class="hljs-type">char</span> global_con_init_b = <span class="hljs-string">&#x27;b&#x27;</span>;<br><br><span class="hljs-type">int</span> global_unin_a;<br><span class="hljs-type">char</span> global_unin_b;<br><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> global_con_unin_a;<br><span class="hljs-type">const</span> <span class="hljs-type">char</span> global_con_unin_b;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *argv[])</span> &#123;<br>  <span class="hljs-type">static</span> <span class="hljs-type">int</span> local_stat_init_a = <span class="hljs-number">3</span>;<br>  <span class="hljs-type">static</span> <span class="hljs-type">char</span> local_stat_init_b = <span class="hljs-string">&#x27;c&#x27;</span>;<br><br>  <span class="hljs-type">const</span> <span class="hljs-type">static</span> <span class="hljs-type">int</span> local_con_stat_init_a = <span class="hljs-number">4</span>;<br>  <span class="hljs-type">const</span> <span class="hljs-type">static</span> <span class="hljs-type">char</span> local_con_stat_init_b = <span class="hljs-string">&#x27;d&#x27;</span>;<br><br>  <span class="hljs-type">static</span> <span class="hljs-type">int</span> local_stat_unin_a;<br>  <span class="hljs-type">static</span> <span class="hljs-type">char</span> local_stat_unin_b;<br><br>  <span class="hljs-type">const</span> <span class="hljs-type">static</span> <span class="hljs-type">int</span> local_con_stat_unin_a;<br>  <span class="hljs-type">const</span> <span class="hljs-type">static</span> <span class="hljs-type">char</span> local_con_stat_unin_b;<br><br>  <span class="hljs-type">int</span> local_init_a = <span class="hljs-number">5</span>;<br>  <span class="hljs-type">char</span> local_init_b = <span class="hljs-string">&#x27;e&#x27;</span>;<br><br>  <span class="hljs-type">const</span> <span class="hljs-type">int</span> local_con_init_a = <span class="hljs-number">6</span>;<br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> local_con_init_b = <span class="hljs-string">&#x27;f&#x27;</span>;<br><br>  <span class="hljs-type">int</span> local_unin_a;<br>  <span class="hljs-type">char</span> local_unin_b;<br><br>  <span class="hljs-type">const</span> <span class="hljs-type">int</span> local_con_unin_a;<br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> local_con_unin_b;<br><br>  sleep(<span class="hljs-number">-1</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>The section information is as follows:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs c">Section<br>  sectname __text<br>   segname __TEXT<br>      addr <span class="hljs-number">0x0000000100003f14</span><br>      size <span class="hljs-number">0x000000000000005c</span><br>    offset <span class="hljs-number">16148</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">2</span> (<span class="hljs-number">4</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x80000400</span><br> reserved1 <span class="hljs-number">0</span><br> reserved2 <span class="hljs-number">0</span><br> Section<br>  sectname __const<br>   segname __TEXT<br>      addr <span class="hljs-number">0x0000000100003fa0</span><br>      size <span class="hljs-number">0x0000000000000015</span><br>    offset <span class="hljs-number">16288</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">2</span> (<span class="hljs-number">4</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x00000000</span><br> reserved1 <span class="hljs-number">0</span><br> reserved2 <span class="hljs-number">0</span><br> Section<br>  sectname __data<br>   segname __DATA<br>      addr <span class="hljs-number">0x0000000100008008</span><br>      size <span class="hljs-number">0x0000000000000015</span><br>    offset <span class="hljs-number">32776</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">3</span> (<span class="hljs-number">8</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x00000000</span><br> reserved1 <span class="hljs-number">0</span><br> reserved2 <span class="hljs-number">0</span><br>Section<br>  sectname __bss<br>   segname __DATA<br>      addr <span class="hljs-number">0x0000000100008020</span><br>      size <span class="hljs-number">0x0000000000000005</span><br>    offset <span class="hljs-number">0</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">2</span> (<span class="hljs-number">4</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x00000001</span><br> reserved1 <span class="hljs-number">0</span><br> reserved2 <span class="hljs-number">0</span><br>Section<br>  sectname __common<br>   segname __DATA<br>      addr <span class="hljs-number">0x0000000100008028</span><br>      size <span class="hljs-number">0x000000000000000d</span><br>    offset <span class="hljs-number">0</span><br>     align <span class="hljs-number">2</span>^<span class="hljs-number">2</span> (<span class="hljs-number">4</span>)<br>    reloff <span class="hljs-number">0</span><br>    nreloc <span class="hljs-number">0</span><br>     flags <span class="hljs-number">0x00000001</span><br> reserved1 <span class="hljs-number">0</span><br> reserved2 <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<p>Look at the corresponding symbol table again:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c">SYMBOL TABLE:<br><span class="hljs-number">0000000100003f</span>a8 l     O __TEXT,__const _main.local_con_stat_init_a<br><span class="hljs-number">0000000100003f</span>ac l     O __TEXT,__const _main.local_con_stat_init_b<br><span class="hljs-number">0000000100003f</span>b0 l     O __TEXT,__const _main.local_con_stat_unin_a<br><span class="hljs-number">0000000100003f</span>b4 l     O __TEXT,__const _main.local_con_stat_unin_b<br><span class="hljs-number">0000000100008008</span> l     O __DATA,__data __dyld_private<br><span class="hljs-number">0000000100008018</span> l     O __DATA,__data _main.local_stat_init_a<br><span class="hljs-number">000000010000801</span>c l     O __DATA,__data _main.local_stat_init_b<br><span class="hljs-number">0000000100008020</span> l     O __DATA,__bss _main.local_stat_unin_a<br><span class="hljs-number">0000000100008024</span> l     O __DATA,__bss _main.local_stat_unin_b<br><span class="hljs-number">0000000100000000</span> g     F __TEXT,__text __mh_execute_header<br><span class="hljs-number">0000000100003f</span>a0 g     O __TEXT,__const _global_con_init_a<br><span class="hljs-number">0000000100003f</span>a4 g     O __TEXT,__const _global_con_init_b<br><span class="hljs-number">0000000100008028</span> g     O __DATA,__common _global_con_unin_a<br><span class="hljs-number">000000010000802</span>c g     O __DATA,__common _global_con_unin_b<br><span class="hljs-number">0000000100008010</span> g     O __DATA,__data _global_init_a<br><span class="hljs-number">0000000100008014</span> g     O __DATA,__data _global_init_b<br><span class="hljs-number">0000000100008030</span> g     O __DATA,__common _global_unin_a<br><span class="hljs-number">0000000100008034</span> g     O __DATA,__common _global_unin_b<br><span class="hljs-number">0000000100003f</span>14 g     F __TEXT,__text _main<br><span class="hljs-number">0000000000000000</span>         *UND* _sleep<br><span class="hljs-number">0000000000000000</span>         *UND* dyld_stub_binder<br></code></pre></td></tr></table></figure>
<p>Finally, look at the contents of the __const section:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">Contents of section __const:<br> <span class="hljs-number">100003f</span>a0 <span class="hljs-number">02000000</span> <span class="hljs-number">62000000</span> <span class="hljs-number">04000000</span> <span class="hljs-number">64000000</span>  ....b.......d...<br> <span class="hljs-number">100003f</span>b0 <span class="hljs-number">00000000</span> <span class="hljs-number">00</span><br></code></pre></td></tr></table></figure>

<p>It can be found that all global variables and local static variables decorated with const are placed in the read-only __const segment. Compared with global variables and local static variables without const modification, there are mainly the following differences:</p>
<ul>
<li>Exposed (external) global variables and internal (non-external) local static variables are in the __const segment;</li>
<li>Both initialized and uninitialized variables are in the __const section;</li>
<li>The __const section does not have the feature of saving executable file space like the __bss section.</li>
</ul>
<p>That is, both uninitialized global variables and local static variables take up executable space.</p>
<p>Let’s take a look at the situation of local variables again, disassembly:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c">(__TEXT,__text) section<br>_main:<br><span class="hljs-number">0000000100003f</span>14        sub     sp, sp, #<span class="hljs-number">0x50</span><br><span class="hljs-number">0000000100003f</span>18        stp     x29, x30, [sp, #<span class="hljs-number">0x40</span>]<br><span class="hljs-number">0000000100003f</span>1c        add     x29, sp, #<span class="hljs-number">0x40</span><br><span class="hljs-number">0000000100003f</span>20        mov     w8, #<span class="hljs-number">0x0</span><br><span class="hljs-number">0000000100003f</span>24        stur    wzr, [x29, #<span class="hljs-number">-0x4</span>]<br><span class="hljs-number">0000000100003f</span>28        stur    w0, [x29, #<span class="hljs-number">-0x8</span>]<br><span class="hljs-number">0000000100003f</span>2c        stur    x1, [x29, #<span class="hljs-number">-0x10</span>]<br><span class="hljs-number">0000000100003f</span>30        mov     w9, #<span class="hljs-number">0x5</span><br><span class="hljs-number">0000000100003f</span>34        stur    w9, [x29, #<span class="hljs-number">-0x14</span>]<br><span class="hljs-number">0000000100003f</span>38        mov     w9, #<span class="hljs-number">0x65</span><br><span class="hljs-number">0000000100003f</span>3c        sturb   w9, [x29, #<span class="hljs-number">-0x15</span>]<br><span class="hljs-number">0000000100003f</span>40        mov     w9, #<span class="hljs-number">0x6</span><br><span class="hljs-number">0000000100003f</span>44        stur    w9, [x29, #<span class="hljs-number">-0x1c</span>]<br><span class="hljs-number">0000000100003f</span>48        mov     w9, #<span class="hljs-number">0x66</span><br><span class="hljs-number">0000000100003f</span>4c        sturb   w9, [x29, #<span class="hljs-number">-0x1d</span>]<br><span class="hljs-number">0000000100003f</span>50        mov     w0, #<span class="hljs-number">-0x1</span><br><span class="hljs-number">0000000100003f</span>54        str     w8, [sp, #<span class="hljs-number">0xc</span>]<br><span class="hljs-number">0000000100003f</span>58        bl      <span class="hljs-number">0x100003f70</span> ; symbol stub <span class="hljs-keyword">for</span>: _sleep<br><span class="hljs-number">0000000100003f</span>5c        ldr     w8, [sp, #<span class="hljs-number">0xc</span>]<br><span class="hljs-number">0000000100003f</span>60        mov     x0, x8<br><span class="hljs-number">0000000100003f</span>64        ldp     x29, x30, [sp, #<span class="hljs-number">0x40</span>]<br><span class="hljs-number">0000000100003f</span>68        add     sp, sp, #<span class="hljs-number">0x50</span><br><span class="hljs-number">0000000100003f</span>6c        ret<br></code></pre></td></tr></table></figure>
<p>What we need to pay attention to are these lines:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">0000000100003f</span>30        mov     w9, #<span class="hljs-number">0x5</span><br><span class="hljs-number">0000000100003f</span>34        stur    w9, [x29, #<span class="hljs-number">-0x14</span>]<br><span class="hljs-number">0000000100003f</span>38        mov     w9, #<span class="hljs-number">0x65</span><br><span class="hljs-number">0000000100003f</span>3c        sturb   w9, [x29, #<span class="hljs-number">-0x15</span>]<br><span class="hljs-number">0000000100003f</span>40        mov     w9, #<span class="hljs-number">0x6</span><br><span class="hljs-number">0000000100003f</span>44        stur    w9, [x29, #<span class="hljs-number">-0x1c</span>]<br><span class="hljs-number">0000000100003f</span>48        mov     w9, #<span class="hljs-number">0x66</span><br><span class="hljs-number">0000000100003f</span>4c        sturb   w9, [x29, #<span class="hljs-number">-0x1d</span>]<br></code></pre></td></tr></table></figure>
<p>According to the method analyzed above, it can be explained that for the initialized local variables, the presence or absence of const modification has no effect on the location of the variables, and they are all in the stack in order.<br>Conclusions:</p>
<ul>
<li>Global variables and local static variables modified by const will be placed in the read-only __const segment; for local variables, whether there is const modification has no effect on the location of the variable, and they are all on the stack.</li>
</ul>
<p>Note that there is a problem here: the read-only __const segment is protected by the operating system, and its internal value cannot be modified; but there is no protection mechanism for local variables modified by const (because they are placed on the stack like ordinary local variables), at this time C language If you want to realize the function of const, you can only intervene in the compilation process to achieve constantization. This question is left for later consideration.</p>
<h2 id="Afterwords"><a href="#Afterwords" class="headerlink" title="Afterwords"></a>Afterwords</h2><p>Good tools can help us get to the bottom of a problem, and this article makes use of some great tools. Of course, we must not only have one tool. In this article, we used <code>nm</code>, <code>otool</code>, <code>objdump</code> to successfully analyze various parts of the C programs.</p>
<p><em>This essay is over here, thank you for reading.</em></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Things-about-C/" class="category-chain-item">Things about C</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/linux/" class="print-no-link">#linux</a>
      
        <a href="/tags/vscode-macos/" class="print-no-link">#vscode macos</a>
      
        <a href="/tags/c/" class="print-no-link">#c++</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Analysis of the Location of Initialized/Uninitialized Global/Static/Local Variables/Constants in Mem</div>
      <div>http://blog.luliang.online/2023/01/10/Analysis of the Location of Initialized!Uninitialized Global!Static!Local Variables!Constants in Mem/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Luyoung</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年1月10日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/01/10/2022%20Personal%20Summary/" title="2022 Personal Summary">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">2022 Personal Summary</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/01/01/%5BProject%201%5DDesign%20a%20Dynamic%20Expansion%20Buffer%20(strbuf)%20with%20C%20Language/" title="Design a Dynamic Expansion Buffer (strbuf) with C Language">
                        <span class="hidden-mobile">Design a Dynamic Expansion Buffer (strbuf) with C Language</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>







  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
